# Unity開発タスクリスト: Primitive Lights (モバイル版)

## ゲーム概要
**タイトル**: Primitive Lights (Heartbeat Runner)
**ジャンル**: 超高速2Dリズムランナー

### コンセプト
「Primitive Lights」は、心電図モニターのような暗闇と光の世界を疾走するリズムアクションゲームです。
プレイヤーは「鼓動（リズム）」と一体になり、視覚的な反応速度だけでなく、音楽的な予測とフロー状態を体験します。

### コアメカニクス
- **操作**: 画面タップのみのワンボタン操作（ジャンプ）。
- **ルール**:
    - 超高速でスクロールするステージを走り抜ける。
    - **白い障害物**：避ける（当たるとライフ減少）。
    - **カラーガイド**：リズムの指標。黄色はリズム、緑はジャンプの予兆を示す。
- **特徴**:
    - **超高速スクロール**: 視認してから反応するのではなく、リズムに乗って予測するプレイ感。
    - **ビジュアル**: 暗黒の背景に、心拍波形やネオンの光のみが輝く「プリミティブ（原始的）」な美しさ。

---

このドキュメントは、「Primitive Lights」をUnityで再構築し、iOSおよびAndroid向けにリリースするためのステップバイステップのタスクリストです。

## フェーズ1: プロジェクト設定とアーキテクチャ
- [ ] **プロジェクトの初期化**
    - [ ] 新規Unity 2Dプロジェクトの作成（推奨: Unity 2022 LTS以降）。
    - [ ] ビルドプラットフォームを即座にAndroid / iOSに切り替える（テクスチャ圧縮形式を正しく設定するため）。
    - [ ] プロジェクト設定（Project Settings）の構成:
        - [ ] **Audio**: DSP Buffer Sizeを「Best Latency」に設定。
        - [ ] **Quality**: VSyncを無効化（コードでフレームレートを管理）、ターゲットフレームレートを60（または対応デバイスでは120）に設定。
        - [ ] **Player**: バンドル識別子（Bundle Identifier）、会社名、製品名を設定。
        - [ ] **Input**: タッチ操作の処理向上のため、「Input System」パッケージ（New Input System）をインストール。
- [ ] **フォルダ構成のセットアップ**
    - [ ] フォルダ作成: `_Scripts`, `_Scenes`, `Audio`, `Prefabs`, `Sprites`, `Materials`, `Shaders`, `Resources/Levels`。
- [ ] **コアマネージャー（シングルトンパターン）**
    - [ ] `GameManager`の実装: ゲーム状態（タイトル、ゲーム、リザルト）を管理。
    - [ ] `AudioManager`の実装: BGMとSEを管理。**重要**: 正確なリズム同期のために `AudioSettings.dspTime` を使用すること。
    - [ ] `InputManager`の実装: タッチ（モバイル）とキーボード/マウス（エディタデバッグ用）の抽象化レイヤー。

## フェーズ2: コアゲームプレイの実装
- [ ] **プレイヤーコントローラー**
    - [ ] `PlayerController`スクリプトの作成。
    - [ ] 物理演算の実装:
        - [ ] **Rigidbody2Dの重力は使用しない**: プロトタイプの挙動を正確に再現するため、`FixedUpdate` または `Update` 内で `Time.deltaTime` を使用した独自の速度/重力計算を実装する。
        - [ ] `Jump()`関数の実装（初速を設定）。
        - [ ] 接地判定の実装（このランナーゲームでは単純なY座標チェックで十分）。
- [ ] **スクロールシステム**
    - [ ] `ScrollManager`の作成。
    - [ ] グローバルなスクロール速度変数の実装。
    - [ ] **オブジェクトプーリング**: ガイド、障害物、パーティクル用の汎用 `ObjectPooler` を作成。**モバイルのパフォーマンス維持（GCスパイク回避）に必須**。
- [ ] **レベルロジック**
    - [ ] レベルデータ構造の定義（UnityではScriptableObjectが最適）。
        - [ ] `LevelData` (ScriptableObject): BPM、オフセット、フェーズのリスト。
        - [ ] `PhaseData` (Class): 長さ（小節数）、リズムパターン、ジャンプ拍、障害物拍。
    - [ ] `LevelGenerator`の実装: `dspTime` と BPM に基づいてプールからオブジェクトを生成（スポーン）。

## フェーズ3: オーディオとリズムシステム（最難関・最重要）
- [ ] **オーディオ同期基盤**
    - [ ] `Conductor`クラスの実装。
    - [ ] `AudioSettings.dspTime` を使用して `songPosition`（曲の再生位置）を追跡。
    - [ ] **レイテンシ補正**: Bluetoothイヤホンやモバイル端末のオーディオ遅延に対応するための、キャリブレーション設定または固定オフセット機能を追加。
- [ ] **オーディオモードの切り替え実装**
    - [ ] **チュートリアル用（プロシージャル）**:
        - [ ] ドラムループの実装: `PlayScheduled` を使用して、ステム（キック、スネア、ハイハット）をシームレスにループ再生。
        - [ ] BPMに基づいて動的に譜面を生成するロジックとの連携。
    - [ ] **本番ステージ用（楽曲再生）**:
        - [ ] `AudioSource` を使用した通常の楽曲（BGM）再生機能の実装。
        - [ ] 楽曲のBPMとオフセット情報を `LevelData` から読み込み、`Conductor` に適用するロジック。
        - [ ] イントロ付きループなどの特殊な再生要件への対応（必要に応じて）。

## フェーズ4: ビジュアルとシェーダー
- [ ] **心電図（ECG）/ モニターエフェクト**
    - [ ] **Shader Graph**: 「心拍ライン」用のカスタムシェーダーを作成。
        - [ ] UVスクロールまたはプロシージャルノイズを使用してECGの波形を模倣。
        - [ ] 「Glow（発光）」プロパティ（Emission）を追加。
    - [ ] **ポストプロセス（Post-Processing）**:
        - [ ] "Universal RP" (URP) をインストール（未選択の場合）。
        - [ ] `Bloom` エフェクトを追加してネオンのような発光感を出す。
        - [ ] `Vignette` を追加して画面端を暗くする。
        - [ ] `Chromatic Aberration`（色収差）を追加して、グリッチや被弾時のエフェクトを表現。
- [ ] **背景**
    - [ ] グリッドシェーダー（スクロールする線）の作成。
    - [ ] パーティクルシステムを使用したパララックス（視差）効果のある星空の実装（Simulation Space: World, Emitter Velocity: Custom）。

## フェーズ5: UIとフィードバック
- [ ] **Canvas（キャンバス）設定**
    - [ ] Canvas Scalerを「Scale With Screen Size」に設定（参照解像度: 1920x1080など）。
    - [ ] UI要素（ライフ、スコア、BPM）を四隅や端に正しくアンカー設定（セーフエリア対応のため）。
- [ ] **モバイルセーフエリア**
    - [ ] `SafeArea`スクリプトを作成し、ノッチやダイナミックアイランドを避けるようにUIのパディングを自動調整。
- [ ] **視覚的フィードバック**
    - [ ] **画面シェイク**: `Cinemachine` Impulse Source または単純な `Camera.main.transform` シェイクスクリプトで実装。
    - [ ] **フラッシュエフェクト**: 白い画像のUIパネルを作成し、スクリプトやAnimationCurveでアルファ値（透明度）を制御。
    - [ ] **パーティクル**: ジャンプ時の土煙、ガイド取得時、被弾時のエフェクトにUnityの `ParticleSystem` を使用。

## フェーズ6: モバイル固有対応と最適化
- [ ] **タッチ入力**
    - [ ] `Touch.phase == Began` をジャンプに割り当て。
    - [ ] UIボタン（ポーズ、リトライなど）を押した時にジャンプが暴発しないようにする（EventSystemのチェック）。
- [ ] **パフォーマンスチューニング**
    - [ ] **フレームレート**: `Application.targetFrameRate = 60;`
    - [ ] **ガベージコレクション（GC）**: `Update` ループ内でメモリ割り当て（`new`）が発生しないようにする。スコアテキストの頻繁な更新には `StringBuilder` を使用するなどの対策を行う。
    - [ ] **バッテリー**: 必要に応じて設定で画質やFPSを下げられるオプションを用意する。

## フェーズ7: 仕上げとリリース準備
- [ ] **トランジション（画面遷移）**
    - [ ] タイトル、ゲーム、リザルト間のスムーズなフェードイン・アウトを作成。
- [ ] **セーブシステム**
    - [ ] `PlayerPrefs` または `JSON` を使用して、ハイスコアやアンロック状況を保存。
- [ ] **ビルド設定**
    - [ ] **アイコン**: Android用のアダプティブアイコンとiOS用のApp Iconセットを生成・設定。
    - [ ] **スプラッシュスクリーン**: Unityのスプラッシュスクリーンを設定（Pro版でない場合）。
    - [ ] **Player Settings**:
        - [ ] Android: 最小APIレベルを設定（例: Android 7.0）。
        - [ ] iOS: ターゲットデバイス（iPhone/iPad）、アーキテクチャ（ARM64）を設定。

## フェーズ8: テスト
- [ ] **実機テスト**: 低スペックなAndroid端末や古いiPhoneでテストし、60fpsが安定することを確認する。
- [ ] **オーディオレイテンシテスト**: 端末のスピーカーとBluetoothイヤホンで同期ズレがないか確認し、調整機能をテストする。
